#----------------------------------------------------------------------
# From the list below, please activate/deactivate the options that
# apply to your run. If you modify any of these options, make sure
# that you recompile the whole code by typing "make clean; make".
#
# Look at end of file for a brief guide to the compile-time options.
#----------------------------------------------------------------------

#--------------------------------------- Basic operation mode of code
OPT   +=  -DPERIODIC
OPT   +=  -DUNEQUALSOFTENINGS
#--------------------------------------- Things that are always recommended
OPT   +=  -DPEANOHILBERT
OPT   +=  -DWALLCLOCK
#--------------------------------------- TreePM Options
#OPT   +=  -DPMGRID=128
#OPT   +=  -DPLACEHIGHRESREGION=3
#OPT   +=  -DENLARGEREGION=1.2
#OPT   +=  -DASMTH=1.25
#OPT   +=  -DRCUT=4.5
#--------------------------------------- Single/Double Precision
#OPT   +=  -DDOUBLEPRECISION
#OPT   +=  -DDOUBLEPRECISION_FFTW
#--------------------------------------- Time integration options
OPT   +=  -DSYNCHRONIZATION
#OPT   +=  -DFLEXSTEPS
#OPT   +=  -DPSEUDOSYMMETRIC
#OPT   +=  -DNOSTOP_WHEN_BELOW_MINTIMESTEP
#OPT   +=  -DNOPMSTEPADJUSTMENT
#--------------------------------------- Output options
#OPT   +=  -DHAVE_HDF5
#OPT   +=  -DOUTPUTPOTENTIAL
#OPT   +=  -DOUTPUTACCELERATION
#OPT   +=  -DOUTPUTCHANGEOFENTROPY
#OPT   +=  -DOUTPUTTIMESTEP
#--------------------------------------- Things for special behaviour
#OPT   +=  -DNOGRAVITY
#OPT   +=  -DNOTREERND
#OPT   +=  -DNOTYPEPREFIX_FFTW
#OPT   +=  -DLONG_X=60
#OPT   +=  -DLONG_Y=5
#OPT   +=  -DLONG_Z=0.2
#OPT   +=  -DTWODIMS
#OPT   +=  -DSPH_BND_PARTICLES
#OPT   +=  -DNOVISCOSITYLIMITER
#OPT   +=  -DCOMPUTE_POTENTIAL_ENERGY
#OPT   +=  -DLONGIDS
#OPT   +=  -DISOTHERMAL
#OPT   +=  -DSELECTIVE_NO_GRAVITY=2+4+8+16
#--------------------------------------- Testing and Debugging options
#OPT   +=  -DFORCETEST=0.1
#--------------------------------------- Glass making
#OPT   +=  -DMAKEGLASS=262144
#----------------------------------------------------------------------
# Here, select compile environment for the target machine. This may need
# adjustment, depending on your local system. Follow the examples to add
# additional target platforms, and to get things properly compiled.
#----------------------------------------------------------------------
#--------------------------------------- Select some defaults
CC       =  mpicc                # sets the C-compiler
OPTIMIZE =  -O2 -Wall -g         # sets optimization and warning flags
# MPICHLIB =  -lmpich
#--------------------------------------- Select target computer
# Have Makefile detect system. Works on Taurus/Lisa
# On MBP set env variable SYSTYPE because hostname depends on wifi connection?
ifndef SYSTYPE
    SYSTYPE := $(shell hostname)
endif
#SYSTYPE="Lisa"
#--------------------------------------- Adjust settings for target computer
# Edit by TLRH, 2016/04/19
ifeq ($(SYSTYPE),*.lisa.surfsara.nl)
  # Make sure env variables are set. Should contain the lib and include paths
  ifndef SARA_INCLUDE_PATH
    $(error SARA_INCLUDE_PATH not set.)
  endif
  ifndef SARA_LIBRARY_PATH
    $(error SARA_LIBRARY_PATH not set.)
  endif
  CC       =  mpicc
  OPTIMIZE =  -O3 -Wall
  GSL_INCL =  -I$(SARA_INCLUDE_PATH)
  GSL_LIBS =  -L$(SARA_LIBRARY_PATH)
  FFTW_INCL=  -I$(SARA_INCLUDE_PATH)
  FFTW_LIBS=  -L$(SARA_LIBRARY_PATH)
  MPICHLIB =
  HDF5INCL =  -I$(SARA_INCLUDE_PATH)
  HDF5LIB  =  -L$(SARA_LIBRARY_PATH) -lhdf5 -lz -lsz
endif

ifneq (HAVE_HDF5,$(findstring HAVE_HDF5,$(OPT)))
HDF5INCL =
HDF5LIB  =
endif

OPTIONS =  $(OPTIMIZE) $(OPT)

EXEC = Gadget2

OBJS   = main.o  run.o  predict.o begrun.o endrun.o global.o  \
     timestep.o  init.o restart.o  io.o    \
     accel.o   read_ic.o  ngb.o  \
     system.o  allocate.o  density.o  \
     gravtree.o hydra.o  driftfac.o  \
     domain.o  allvars.o potential.o  \
         forcetree.o   peano.o gravtree_forcetest.o \
     pm_periodic.o pm_nonperiodic.o longrange.o

INCL   = allvars.h  proto.h  tags.h  Makefile

CFLAGS = $(OPTIONS) $(GSL_INCL) $(FFTW_INCL) $(HDF5INCL) -static

ifeq (NOTYPEPREFIX_FFTW,$(findstring NOTYPEPREFIX_FFTW,$(OPT)))    # fftw installed with type prefix?
  FFTW_LIB = $(FFTW_LIBS) -lrfftw_mpi -lfftw_mpi -lrfftw -lfftw
else
ifeq (DOUBLEPRECISION_FFTW,$(findstring DOUBLEPRECISION_FFTW,$(OPT)))
  FFTW_LIB = $(FFTW_LIBS) -ldrfftw_mpi -ldfftw_mpi -ldrfftw -ldfftw
else
  FFTW_LIB = $(FFTW_LIBS) -lsrfftw_mpi -lsfftw_mpi -lsrfftw -lsfftw
endif
endif

LIBS   =   $(HDF5LIB) -g  $(MPICHLIB)  $(GSL_LIBS) -lgsl -lgslcblas -lm $(FFTW_LIB)

$(EXEC): $(OBJS)
		$(CC) $(OBJS) $(LIBS)   -o  $(EXEC)

$(OBJS): $(INCL)

clean:
		rm -f $(OBJS) $(EXEC)
